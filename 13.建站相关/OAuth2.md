安全与认证

![img](OAuth2.assets/797930-20161203152650974-276822362.png)

# OAuth 2.0

**简单说，OAuth 就是一种授权机制。数据的所有者告诉系统，同意授权第三方应用进入系统，获取这些数据。系统从而产生一个短期的进入令牌（token），用来代替密码，供第三方应用使用。**

OAuth 2.0 的标准是 [RFC 6749](https://tools.ietf.org/html/rfc6749) 文件

## 场景与角色

为了便于说明, 我们来看看以下场景

1. 微博登录/微信登录等授权登录
2. 业主给快递员授予进入小区的权力

在前面的场景中, 有以下几种角色

1. Third-party application：第三方应用程序，本文中又称"客户端"（client），即上一节例子中的"云冲印"。
2. HTTP service：HTTP服务提供商，本文中简称"服务提供商"，即上一节例子中的Google。
3. Resource Owner：资源所有者，本文中又称"用户"（user）。
4. User Agent：用户代理，本文中就是指浏览器。
5. Authorization server：认证服务器，即服务提供商专门用来处理认证的服务器。
6. Resource server：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。

## 1. 四种授权机制

OAuth在"客户端"与"服务提供商"之间，设置了一个授权层（authorization  layer）。"客户端"不能直接登录"服务提供商"，只能登录授权层，以此将用户与客户端区分开来。"客户端"登录授权层所用的令牌（token），与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。

"客户端"登录授权层以后，"服务提供商"根据令牌的权限范围和有效期，向"客户端"开放用户储存的资料。

**OAuth 的核心就是向第三方应用颁发令牌**.

不管哪一种授权方式，**第三方应用申请令牌之前，都必须先到系统备案**，说明自己的身份，然后会拿到两个身份识别码：客户端 ID（client ID）和客户端密钥（client secret）。这是为了防止令牌被滥用，没有备案过的第三方应用，是不会拿到令牌的。

![OAuth运行流程](OAuth2.assets/bg2014051203.png)

1. 用户打开客户端以后，客户端要求用户给予授权。
2. 用户同意给予客户端授权。
3. 客户端使用上一步获得的授权，向认证服务器申请令牌。
4. 认证服务器对客户端进行认证以后，确认无误，同意发放令牌。
5. 客户端使用令牌，向资源服务器申请获取资源。
6. 资源服务器确认令牌无误，同意向客户端开放资源。

其中第二步是关键，即**用户怎样才能给于客户端授权**。有了这个授权以后，客户端就可以获取令牌，进而凭令牌获取资源。

### 1.1. 授权码 authorization-code

**授权码（authorization code）方式，指的是第三方应用先申请一个授权码，然后再用该码获取令牌。**

这种方式是最常用的流程，安全性也最高，它**适用于那些有后端的 Web 应用**。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。

需要验证客户端的身份, 因此需要使用 `client_secret` , 这个密码要在后端保存, 不能在前端直接使用

![img](OAuth2.assets/bg2019040905.jpg)

### 1.2. 隐藏式(简化模式)

![img](OAuth2.assets/bg2019040906.jpg)

这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间（session）有效，浏览器关掉，令牌就失效了。

### 1.3. 密码式



### 1.4. 凭证式



一次登录, 多服务跳转怎么实现? 



## JWK 与 JWT



## Spring Security